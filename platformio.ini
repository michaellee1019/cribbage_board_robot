[platformio]
default_envs = controller

[env]
platform = espressif32
board = seeed_xiao_esp32s3
framework = arduino
monitor_speed = 115200
monitor_filters = esp32_exception_decoder
lib_deps =
	Wire
	painlessMesh
	adafruit/Adafruit seesaw Library@^1.7.5
	adafruit/Adafruit MCP23017 Arduino Library@^2.3.2
	sparkfun/SparkFun Qwiic Alphanumeric Display Arduino Library@^2.1.4

build_unflags = -std=gnu++11
build_flags = -std=gnu++17 -DCORE_DEBUG_LEVEL=5

debug_tool = esp-prog
debug_init_break = tbreak setup
upload_protocol = esptool
debug_speed = 2000

board_build.partitions = partitions.csv

[env:controller]

[env:red]
upload_port = /dev/cu.usbmodem101
monitor_port = /dev/cu.usbmodem101

[env:blue]
upload_port = /dev/cu.usbmodem2101
monitor_port = /dev/cu.usbmodem2101

# Test environment - completely separate from other environments
[env:test]
platform = native
framework = 
lib_deps =
    throwtheswitch/Unity@^2.5.2
build_flags = 
    -std=gnu++17
    -DUNIT_TEST
    -DARDUINO=100
    -DESP32=1
test_framework = unity
test_build_src = no  # Don't build project source files
test_ignore = test/stubs
extra_scripts =
    pre:test_config.py
